<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANGST</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .auth { display: block; }
        .app { display: none; }
        .post {
            background: #1a1a1a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
        }
        button {
            background: #1DA1F2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
        }
        .error { color: red; margin: 10px 0; }
        .success { color: green; margin: 10px 0; }
    </style>
</head>
<body>
    <!-- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø -->
    <div id="auth" class="auth">
        <h2>ANGST</h2>
        <div id="loginForm">
            <input type="email" id="loginEmail" placeholder="Email" value="test@test.com">
            <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="123456">
            <button onclick="login()">–í–æ–π—Ç–∏</button>
            <button onclick="showRegister()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            <div id="authError" class="error"></div>
        </div>
        
        <div id="registerForm" style="display: none;">
            <input type="text" id="registerName" placeholder="–ò–º—è">
            <input type="email" id="registerEmail" placeholder="Email">
            <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å (6+ —Å–∏–º–≤–æ–ª–æ–≤)">
            <button onclick="register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            <button onclick="showLogin()">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –ü–†–ò–õ–û–ñ–ï–ù–ò–ï -->
    <div id="app" class="app">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>üêâ ANGST</h2>
            <button onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
        
        <div id="userInfo" style="background: #1a1a1a; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            –ü—Ä–∏–≤–µ—Ç, <span id="username">...</span>!
        </div>
        
        <!-- –°–û–ó–î–ê–ù–ò–ï –ü–û–°–¢–ê -->
        <div style="background: #1a1a1a; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            <textarea id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ? (–º–∞–∫—Å. 280 —Å–∏–º–≤–æ–ª–æ–≤)" rows="3" maxlength="280"></textarea>
            <div style="text-align: right; color: #888; font-size: 14px; margin: 5px 0;">
                <span id="charCount">280</span> —Å–∏–º–≤–æ–ª–æ–≤
            </div>
            <button onclick="createPost()" style="width: 100%;">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>
        
        <!-- –õ–ï–ù–¢–ê -->
        <div id="posts">
            <div style="text-align: center; padding: 40px; color: #888;">
                –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...
            </div>
        </div>
    </div>

    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <script>
    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    console.log("–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω!");
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    let currentUser = null;
    let userData = null;

    // ========== –°–ß–Å–¢–ß–ò–ö –°–ò–ú–í–û–õ–û–í ==========
    document.getElementById('postText').addEventListener('input', function() {
        document.getElementById('charCount').textContent = 280 - this.value.length;
    });

    // ========== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==========
    function showRegister() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = 'block';
    }
    
    function showLogin() {
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('loginForm').style.display = 'block';
    }

    function login() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        document.getElementById('authError').textContent = '';
        
        auth.signInWithEmailAndPassword(email, password)
            .then((user) => {
                console.log("–í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω:", user.user.email);
                currentUser = user.user;
                loadUserData();
            })
            .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error);
                document.getElementById('authError').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
            });
    }

    function register() {
        const name = document.getElementById('registerName').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        
        if (password.length < 6) {
            alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
            return;
        }
        
        auth.createUserWithEmailAndPassword(email, password)
            .then((user) => {
                console.log("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞");
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                return db.collection('users').doc(user.user.uid).set({
                    username: name,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            })
            .then(() => {
                alert('–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω!');
                showLogin();
            })
            .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", error);
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            });
    }

    function logout() {
        auth.signOut();
    }

    // ========== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ==========
    function loadUserData() {
        if (!currentUser) return;
        
        db.collection('users').doc(currentUser.uid).get()
            .then((doc) => {
                if (doc.exists) {
                    userData = doc.data();
                    updateUI();
                    loadPosts();
                }
            })
            .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
            });
    }

    function updateUI() {
        if (currentUser && userData) {
            document.getElementById('auth').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('username').textContent = userData.username || currentUser.email;
        } else {
            document.getElementById('auth').style.display = 'block';
            document.getElementById('app').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('authError').textContent = '';
        }
    }

    // ========== –ü–û–°–¢–´ ==========
    function createPost() {
        if (!currentUser) {
            alert('–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç!');
            return;
        }
        
        const text = document.getElementById('postText').value.trim();
        if (!text) {
            alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞!');
            return;
        }
        
        const postData = {
            text: text,
            authorId: currentUser.uid,
            authorName: userData.username || currentUser.email,
            likes: 0,
            comments: 0,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            timestamp: new Date().toLocaleTimeString()
        };
        
        db.collection('posts').add(postData)
            .then(() => {
                console.log("–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω");
                document.getElementById('postText').value = '';
                document.getElementById('charCount').textContent = '280';
                loadPosts();
            })
            .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:", error);
                alert('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ' + error.message);
            });
    }

    function loadPosts() {
        if (!currentUser) return;
        
        db.collection('posts')
            .orderBy('createdAt', 'desc')
            .limit(20)
            .get()
            .then((querySnapshot) => {
                const postsDiv = document.getElementById('posts');
                if (querySnapshot.empty) {
                    postsDiv.innerHTML = '<div style="text-align: center; padding: 40px; color: #888;">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
                    return;
                }
                
                let postsHTML = '';
                querySnapshot.forEach((doc) => {
                    const post = doc.data();
                    postsHTML += `
                        <div class="post">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>${post.authorName}</strong>
                                <span style="color: #888; font-size: 14px;">${post.timestamp || ''}</span>
                            </div>
                            <div style="margin-bottom: 10px;">${post.text}</div>
                            <div>
                                <button onclick="likePost('${doc.id}')">‚ù§Ô∏è ${post.likes || 0}</button>
                                <button onclick="comment('${doc.id}')">üí¨ ${post.comments || 0}</button>
                            </div>
                        </div>
                    `;
                });
                
                postsDiv.innerHTML = postsHTML;
            })
            .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤:", error);
                document.getElementById('posts').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤</div>';
            });
    }

    function likePost(postId) {
        if (!currentUser) {
            alert('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫–∏!');
            return;
        }
        alert('–õ–∞–π–∫ –¥–æ–±–∞–≤–ª–µ–Ω! (–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ)');
    }

    function comment(postId) {
        const commentText = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:');
        if (commentText) {
            alert('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!');
        }
    }

    // ========== –°–õ–£–®–ê–¢–ï–õ–¨ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========
    auth.onAuthStateChanged((user) => {
        console.log("–°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:", user ? user.email : "–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
        currentUser = user;
        if (user) {
            loadUserData();
        } else {
            userData = null;
            updateUI();
        }
    });

    // ========== –ó–ê–ü–£–°–ö ==========
    console.log("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ");
    updateUI();
    </script>
</body>
</html>
